jQuery(document).ready(function(t){var e=function(){var e=t('input[name="stockticker_defaults[all_symbols]"]').val().toString().split(",").length*t('input[name="stockticker_defaults[timeout]"]').val()*1.5;t("#fetch_timeout_advisor .min").html(Math.ceil(e))};t('input[name="stockticker_defaults[cache_timeout]"]').after('&nbsp;<span id="fetch_timeout_advisor">at least <span class="min"></span></span>'),e(),t('input[name="stockticker_defaults[timeout]"], input[name="stockticker_defaults[all_symbols]"]').on("change click keydown",function(t){e()}),t('button[name="st_force_data_fetch_stop"]').on("click",function(e){e.preventDefault(),t(this).data("stop","true")}),t('button[name="st_force_data_fetch"]').on("click",function(e){e.preventDefault();var a=this,s=t('button[name="st_force_data_fetch_stop"]');t(a).prop("disabled",!0),t(s).addClass("enabled"),t.ajax({type:"post",dataType:"json",async:!0,url:stockTickerJs.ajax_url,data:{action:"stockticker_purge_cache"}}).done(function(e){function n(){t.ajax({type:"post",dataType:"json",async:!0,url:stockTickerJs.ajax_url,data:{action:"stockticker_update_quotes"}}).done(function(e){if(e.done||"true"==t(s).data("stop"))"DONE"!=e.message?t(".st_force_data_fetch").append("<br />["+e.symbol+"] "+e.message):t(".st_force_data_fetch").append("<br />DONE"),t(a).prop("disabled",!1),t(s).removeClass("enabled").data("stop","false");else{if(e.message.indexOf("Operation timed out")>=0)t(".st_force_data_fetch").append("[Timeout] "+e.symbol+"<br />");else if(e.message.indexOf("Invalid API call")>=0){var o=stockTickerJs.avurl;"intraday"==e.method&&(o=stockTickerJs.avurli),t(".st_force_data_fetch").append("[Invalid API call] "+e.symbol+' (<a href="'+o+e.symbol+'" target="_blank">test</a>)<br />')}else t(".st_force_data_fetch").append("[OK] "+e.symbol+"<br />");setTimeout(function(){n()},2e3)}}).fail(function(e){t(".st_force_data_fetch").append("<br />[Error] "+e.message)})}t(".st_force_data_fetch").html("Reset fetching loop and fetch data again. Please wait...<br /><br />"),n()})})});